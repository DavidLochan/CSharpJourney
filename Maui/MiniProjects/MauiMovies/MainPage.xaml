<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="MauiMovies.MainPage"
             BackgroundColor="#0F0F0F">

<Grid>
    <Grid  ColumnDefinitions="285,*">

        <!-- Sidebar -->
        <VerticalStackLayout
            Grid.Column="0"
            Padding="20"
            Spacing="20"
            BackgroundColor="#1A1A1A">

            <Label Text="🎬 MauiMovies"
                   FontSize="22"
                   FontAttributes="Bold"
                   TextColor="White"/>

            <Label Text="Home" FontSize="18" TextColor="#CCCCCC"/>
            <Label Text="Movies" FontSize="18" TextColor="White"/>
            <Label Text="Profile" FontSize="18" TextColor="#CCCCCC"/>
        </VerticalStackLayout>

        <!-- Main Content with FlexLayout -->
        <ScrollView Grid.Column="1">
            <FlexLayout
                Direction="Row"
                Wrap="Wrap"
                JustifyContent="Start"
                AlignItems="Start"
                Padding="24"
                BindableLayout.ItemsSource="{Binding Movies}">

                <BindableLayout.ItemTemplate>
                    <DataTemplate>
                        <VerticalStackLayout 
                            WidthRequest="210"
                            Margin="12"
                            Spacing="8">

                            <VerticalStackLayout.GestureRecognizers>
                                <PointerGestureRecognizer
                                    PointerEntered="OnPointerEntered"
                                    PointerExited="OnPointerExited"/>
                                  <TapGestureRecognizer
                                   Tapped="OnMovieTapped"/>
                            </VerticalStackLayout.GestureRecognizers>

                            <Border 
                                StrokeThickness="1"
                                Stroke="#333"
                                BackgroundColor="#222"
                                HeightRequest="300"
                                WidthRequest="210">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="12"/>
                                </Border.StrokeShape>

                                <Image Source="{Binding Poster}"
                                       Aspect="AspectFill"
                                       MinimumWidthRequest="180"/>
                            </Border>

                            <Label Text="{Binding Title}"
                                   TextColor="White"
                                   FontSize="15"
                                   FontAttributes="Bold"
                                   LineBreakMode="TailTruncation"
                                   MaxLines="2"/>

                            <Label Text="{Binding Rating, StringFormat='⭐ {0:F1}'}"
                                   TextColor="#F5C542"
                                   FontSize="14"/>
                        </VerticalStackLayout>
                    </DataTemplate>
                </BindableLayout.ItemTemplate>

            </FlexLayout>
        </ScrollView>
    </Grid>

<Grid
            IsVisible="{Binding IsPopupVisible}"
            BackgroundColor="#66000000"
            Opacity = "1"
            InputTransparent="False">

            <Grid.GestureRecognizers>
                <TapGestureRecognizer Tapped="ClosePopup"/>
            </Grid.GestureRecognizers>

            <Border
                BackgroundColor="#1E1E1E"
                WidthRequest="520"
                HeightRequest="720"
                HorizontalOptions="Center"
                VerticalOptions="Center"
                Padding="24"
                Stroke="#333"
                StrokeThickness="1">

                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="16"/>
                </Border.StrokeShape>

                <VerticalStackLayout Spacing="16">

                    <Image
                        Source="{Binding SelectedMovie.Poster}"
                        HeightRequest="360"
                        Aspect="AspectFit"/>

                    <Label
                        Text="{Binding SelectedMovie.Title}"
                        FontSize="28"
                        FontAttributes="Bold"
                        TextColor="White"/>

                    <Label
                        Text="{Binding SelectedMovie.Rating, StringFormat='⭐ {0:F1}'}"
                        FontSize="20"
                        TextColor="#F5C542"/>
                    
                    <Label 
                        Text="Movie details and synopsis would go here. This provides a deep dive into the cinematic experience."
                        TextColor="#CCCCCC"
                        FontSize="14"/>

                    <Button
                        Text="Close"
                        Clicked="ClosePopup"
                        BackgroundColor="#CC3333"
                        TextColor="White"
                        CornerRadius="8"
                        HorizontalOptions="End"
                        Margin="0,20,0,0"/>

                </VerticalStackLayout>
            </Border>
        </Grid>
    </Grid>
</ContentPage>